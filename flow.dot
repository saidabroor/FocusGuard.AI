digraph workflow {
    rankdir=LR;
    node [shape=box, style=filled];

    // === Inputs ===
    subgraph cluster_inputs {
        label="Inputs";
        color=lightgrey;
        A1 [label="Webcam (live)", fillcolor=lightblue];
        A2 [label="Video file (videos/test_video.mp4)", fillcolor=lightblue];
        A3 [label="HTTP Client / Frontend", fillcolor=lightblue];
    }

    // === Frontend ===
    subgraph cluster_frontend {
        label="Frontend";
        color=lightgrey;
        F1 [label="test_webcam_client.py", fillcolor=lightgreen];
        F2 [label="streamlit_app.py", fillcolor=lightgreen];
    }

    // === Backend ===
    subgraph cluster_backend {
        label="Backend";
        color=lightgrey;
        B0 [label="app.py (Flask API)", fillcolor=orange];
        B1 [label="predictor.py", fillcolor=orange];
    }

    // === Utils ===
    subgraph cluster_utils {
        label="Utils";
        color=lightgrey;
        U1 [label="eye_drowsiness.py\n(EyeStateDetector)", fillcolor=yellow];
        U2 [label="head_pose.py\n(get_head_pose)", fillcolor=yellow];
        U3 [label="focus_tracker.py\n(FocusEventTracker)", fillcolor=yellow];
    }

    // === Models ===
    subgraph cluster_models {
        label="Models";
        color=lightgrey;
        M1 [label="drowsiness_model.dat\n(68-landmarks predictor)", fillcolor=lightpink];
        M2 [label="shape_predictor_68_face_landmarks.dat", fillcolor=lightpink];
        M3 [label="yolov8n.pt (YOLO weights)", fillcolor=lightpink];
    }

    // === Video Batch ===
    subgraph cluster_batch {
        label="Video Batch";
        color=lightgrey;
        V1 [label="video_analysis.py", fillcolor=khaki];
        V2 [label="test_yolo_webcam.py", fillcolor=khaki];
    }

    // === Tests ===
    subgraph cluster_tests {
        label="Tests";
        color=lightgrey;
        T1 [label="test_drowsiness_model.py", fillcolor=lightcoral];
        T2 [label="test_head_pose.py", fillcolor=lightcoral];
    }

    // === Logs & Analysis ===
    subgraph cluster_logs {
        label="Logs & Analysis";
        color=lightgrey;
        L1 [label="logs/focus_log.csv", fillcolor=lightcyan];
        L2 [label="logs/focus_timeline.csv", fillcolor=lightcyan];
        N1 [label="notebooks/notebook.ipynb", fillcolor=lightcyan];
    }

    // === Repo Files ===
    subgraph cluster_repo {
        label="Repo Files";
        color=lightgrey;
        R1 [label="README.md", fillcolor=white];
        R2 [label="requirements.txt", fillcolor=white];
        R3 [label=".gitignore", fillcolor=white];
    }

    // === Workflow edges ===
    A1 -> F1;
    A1 -> B0;
    A1 -> V2;
    A2 -> V1;
    A3 -> B0;

    F1 -> B0;
    F2 -> N1;
    B0 -> B1;

    B1 -> U1;
    B1 -> U2;
    B1 -> U3;

    U1 -> M1;
    U1 -> M2;
    U2 -> M2;
    V2 -> M3;

    V1 -> U1;
    V1 -> U2;
    V1 -> U3;
    V1 -> L2;

    U3 -> L1;
    U3 -> L2;

    N1 -> L1;
    N1 -> L2;

    T1 -> M1;
    T1 -> A1;
    T2 -> U2;
    T2 -> A1;

    F1 -> A1;
    B1 -> B0;
    B0 -> F1;

    R1 -> B0;
    R2 -> U1;
    R2 -> U2;
    R2 -> B0;
}
